<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="stylesheet" href="/static/main/css/style.css" />
    <link rel="stylesheet" href="/static/accounts/css/profile.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
        integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <!-- header section -->

    {% include 'base/base.html' %}
    <!-- main body  -->

    <div class="main-body container">
        <!-- users day -->

        <div class="user-day">
            <div class="day">
                <div class="fake">
                    <img src="/static/main/images/dp.jpg" />
                </div>
                <p>lorem.isp...</p>
            </div>

            <div class="day">
                <div class="fake">
                    <img src="/static/main/images/dp.jpg" />
                </div>
                <p>lorem.isp...</p>
            </div>
            <div class="day">
                <div class="fake">
                    <img src="/static/main/images/dp.jpg" />
                </div>
                <p>lorem.isp...</p>
            </div>
            <div class="day">
                <div class="fake">
                    <img src="/static/main/images/dp.jpg" />
                </div>
                <p>lorem.isp...</p>
            </div>
            <div class="day">
                <div class="fake">
                    <img src="/static/main/images/dp.jpg" />
                </div>
                <p>lorem.isp...</p>
            </div>
            <div class="day">
                <div class="fake">
                    <img src="/static/main/images/dp.jpg" />
                </div>
                <p>lorem.isp...</p>
            </div>
            <div class="day">
            </div>

        </div>
        <div class="main-x">
            <div class="newfeed ">
                {% for pts in allunlikedpost %} 
                <div class="single-user">

                    <div class="post-nav">
                        <div class="user-pro">
                            <img src="{{pts.profile.profilePic.url}}" />
                            <p>{{pts.profile.username}}</p>
                        </div>
                        <div class="dotdot">
                            <p></p>
                            <p></p>
                            <p></p>
                        </div>
                    </div>
                    <div class="post-picture">
                        <div id="carouselExampleIndicators{{ pts.id }}" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-indicators">
                                {% for image in pts.postimages.all %}
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %} class="active" {% endif %} aria-current="{% if forloop.first %}true{% else %}false{% endif %}" aria-label="Slide {{ forloop.counter0 }}">
                                </button>
                                {% endfor %}
                            </div>
                            <div class="carousel-inner">
                                {% for image in pts.postimages.all %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <img src="{{ image.image.url }}" class="d-block w-100" alt="...">
                                </div>
                                {% endfor %}
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators{{ pts.id }}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators{{ pts.id }}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </div>

                    <div class="footer">
                        <div class="left-side">
                            <div class="left-side d-flex m-2">
                                {% comment %} <form method='post' id="likepost">
                                    {% csrf_token %}
                                    <input hidden type='text' value='{{post.id}}' name='post_id'>
                                    <button type='submit'><i class="bi bi-suit-heart-fill m-2 fs-4"></i> </button>
                                </form> {% endcomment %}
                                {{likedpost}}
                                <button onclick="likePost('{{ pts.id }}')"><i class="bi bi-suit-heart {% if likedpost == True %} -fill {% endif %} fill m-2 fs-4"></i></button>


                                <i class="bi bi-chat m-2 fs-4"></i>
                                <i class="bi bi-send-plus-fill m-2 fs-4"></i>
                            </div>
                        </div>

                        <div class="right-side">
                            <svg aria-label="Save" class="_8-yf5 " color="#8e8e8e" fill="#8e8e8e" height="24" role="img"
                                viewBox="0 0 48 48" width="24">
                                <path
                                    d="M43.5 48c-.4 0-.8-.2-1.1-.4L24 29 5.6 47.6c-.4.4-1.1.6-1.6.3-.6-.2-1-.8-1-1.4v-45C3 .7 3.7 0 4.5 0h39c.8 0 1.5.7 1.5 1.5v45c0 .6-.4 1.2-.9 1.4-.2.1-.4.1-.6.1zM24 26c.8 0 1.6.3 2.2.9l15.8 16V3H6v39.9l15.8-16c.6-.6 1.4-.9 2.2-.9z">
                                </path>
                            </svg>
                        </div>
                    </div>

                    <div class="details">
                        <div class="liked-by">
                            <img src="/static/main/images/dp.jpg" />
                            <p>Liked by <b>earthfever and
                                {{pta.likes_counts}}</b>others</p>
                        </div>
                        <form id="sendcomment" method='post'>
                            {% csrf_token %}
                            <input type='text' name='comment' placeholder ='Wanna comment' >
                            <input type='text' name='id' value='{{pts.id}}' hidden >
                            <input type='submit'  >
                            
                        </form>
                        <div class="post-text">
                            <b>tripfever</b> The beautiful beaches of Italy üèñ Get your photos posted in our account,
                            apply for a feature visiting tripfever.net üëâüèº the link is in our bio: @tripfever
                            Which of these spots is your favorite? üáÆüáπ
                        </div>

                        <div class="hours-ago">
                            18 hours ago
                        </div>
                        
                        {% for com in pts.comentpost.all %}
                        <p>{{ com.comment }}</p>
                        {% endfor %}
                        
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="main-nav mt-5">
                <div class="user-pro">
                    <div class="left-side">
                        <img src="{{profile.profilePic.url}}" />
                        <div class="names">
                            <h1>{{profile.username}}</h1>
                            <h2>{{profile.firstname}} {{profile.lastname}}</h2>
                        </div>
                    </div>
                    <p>
                        <a href="{% url 'login' %}">switchch</a>
                    </p>
                </div>

                <div class="suggestions">
                    <div class="left">
                        Suggestions For You
                    </div>
                    <div class="right">
                        See All
                    </div>
                </div>

                {% for user in alluser %}
                <div class="user-pro sugges">
                    <div class="left-side">
                        <img style="height: 35px;width: 35px;" class="suggestion-photo" src="{{user.profilePic.url}}" />
                        <div class="names">
                            <a href="{% url 'allprofile' user.uid %}">
                                <h1>{{user.username}}</h1>
                            </a>
                            <h2>{{user.firstname}}{{user.lastname}}</h2>
                        </div>
                    </div>
                    <form id="senduid-form" method="post">
                        {% csrf_token %}
                        <input name="followinguid" value="{{user.uid}}" hidden>
                        <button class="btn btn-primary" type="submit">Follow</button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>


    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Alertify request start -->
    {% if messages %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
    <script>
        $(document).ready(function () {
            {% for message in messages %}
            {% if message.tags %}
            {% if message.tags == 'success' %}
            alertify.success('{{ message|escapejs }}');
            {% elif message.tags == 'info' %}
            alertify.message('{{ message|escapejs }}');
            {% elif message.tags == 'warning' %}
            alertify.warning('{{ message|escapejs }}');
            {% elif message.tags == 'error' %}
            alertify.error('{{ message|escapejs }}');
            {% endif %}
            {% endif %}
            {% endfor %}
        });
    </script>
    {% endif %}


    <!-- Ajax Request start following ajax  -->
    <script>
        $(document).ready(function () {
            $('#senduid-form').submit(function (event) {
                event.preventDefault();
                var formData = $(this).serialize();
                var formId = $(this).attr('id');
                $.ajax({
                    url: 'http://127.0.0.1:8000/home/',
                    type: 'POST',
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        if (data.status == 'success') {
                            window.location.href = 'http://127.0.0.1:8000/home/';
                        } else {
                            window.location.href = 'http://127.0.0.1:8000/';
                        }
                    },
                    error: function () {
                        window.location.href = 'http://127.0.0.1:8000/profile/';
                    }
                });
            });
        });
    </script>
    <!-- Ajax Request end  -->
    

    
    <script>
        function likePost(postId) {
            $.ajax({
                type: 'POST',
                url: 'http://127.0.0.1:8000/liked/',
                data: { 'post_id': postId, csrfmiddlewaretoken: '{{ csrf_token }}' },
                success: function(data) {
                    // Update the UI here
                    alert(data.message);
                    window.location = window.location.href;
                },
                error: function(xhr, status, error) {
                    // Handle errors
                    console.log('Error: ' + error.message);
                }
            });
        }
    </script> 


    <!-- Ajax Request start following ajax  -->
    <script>
        $(document).ready(function () {
            $('#sendcomment').submit(function (event) {
                event.preventDefault();
                var formData = $(this).serialize();
                ;
                $.ajax({
                    url: 'http://127.0.0.1:8000/comment/',
                    type: 'POST',
                    data: formData,
                    success: function (data) {
                        console.log(data);
                        if (data.status == 'success') {
                            window.location = window.location.href;
                        } else {
                            window.location.href = 'http://127.0.0.1:8000/';
                        }
                    },
                    error: function () {
                        window.location.href = 'http://127.0.0.1:8000/profile/';
                    }
                });
            });
        });
    </script>
    <!-- Ajax Request end  -->

</body>

</html>